#!/usr/bin/env python3

import json
import sys

from jinja2 import Environment, FileSystemLoader, select_autoescape
from os.path import expanduser, exists, join

def generate(conf_dir, template_file, json_file):
    conf_path = expanduser(conf_dir)

    json_path = join(conf_path, json_file)
    if not exists(json_path):
        print('JSON file does not exist!')
        exit(1)

    env = Environment(
        loader = FileSystemLoader(conf_path, followlinks=True),
        autoescape = select_autoescape([])
    )

    with open(json_path) as fh:
        env.globals = json.load(fh)
        template = env.get_template(template_file)
        print('# ACHTUNG: This file is automatically generated, please do not edit it!')
        print(template.render())

    fh.close()

if __name__ == '__main__':
    generate('~/.config/i3', 'config.j2', 'config.json')
