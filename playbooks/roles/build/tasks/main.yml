---
- name: Add repository keys by URL
  apt_key: state=present url='{{ item }}'
  become: yes
  with_items:
    - 'https://deb.nodesource.com/gpgkey/nodesource.gpg.key'

- name: Add repositories
  apt_repository: repo='{{ item }}'
  register: ppa
  become: yes
  with_items:
    - 'deb https://deb.nodesource.com/node_12.x focal main'

- name: Update package cache
  apt: update_cache=yes
  become: yes
  when: ppa.changed

- name: Install build packages
  become: yes
  apt:
    name:
      - apt-file
      - build-essential
      - gdb
      - git-flow
      - gnupg
      - pbuilder
      - php-cli
      - ubuntu-dev-tools

- name: Install npm and node
  become: yes
  apt:
    name:
      - nodejs

- name: Create Node global install directory
  file: path={{ item }} state=directory
  with_items:
    - ~/.npm-packages/

- name: Symlink Node dotfiles
  shell: stow -d ~/Dotfiles -t ~ node

- name: Install poetry
  shell: pipx install poetry
  args:
    creates: ~/.local/bin/poetry

- name: Install ptpython
  shell: pipx install ptpython
  args:
    creates: ~/.local/bin/ptpython

- name: Symlink Python dotfiles
  shell: stow -d ~/Dotfiles -t ~ python

# Hopefully there's never a problem with getcomposer.org :/
- name: Install Composer
  shell: curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
  become: yes
  args:
    creates: /usr/local/bin/composer
    warn: no

- name: Symlink PHP dotfiles
  shell: stow -d ~/Dotfiles -t ~ php

- name: Symlink Go dotfiles
  shell: stow -d ~/Dotfiles -t ~ go

- name: Install gdbinit
  get_url:
    url: https://git.io/.gdbinit
    dest: ~/.gdbinit
    mode: 0644
