---
- name: Install foreign language support
  become: yes
  shell: apt-get install $(check-language-support -l {{ item }})
  args:
    warn: no
  with_items:
    - ja

- name: Set MATE settings
  dconf: key="/org/mate/{{ item.key }}" value={{ item.value }}
  loop:
    - { key: 'desktop/interface/monospace-font-name', value: "'PragmataPro Mono 10.5'" }
    # Part of what is necessary to disable GNOME Keyring SSH agent
    # http://william.shallum.net/random-notes/disabling-gnome-keyring-daemon-ssh-agent-on-mate-desktop
    - { key: 'desktop/session/gnome-compat-startup', value: "['smproxy']" }
    - { key: 'panel/objects/workspaceswitcherapplet/prefs/display-all-workspaces', value: "true" }
    - { key: 'panel/objects/workspaceswitcherapplet/prefs/num-rows', value: "1" }
    - { key: 'marco/general/num-workspaces', value: "8" }
    # Disable GNOME Screenshot in favor of Flameshot
    - { key: 'marco/global-keybindings/run-command-screenshot', value: "'disabled'" }
    - { key: 'panel/objects/clockapplet/prefs/format', value: "'24-hour'" }
    - { key: 'panel/objects/clockapplet/prefs/show-date', value: "true" }
    - { key: 'desktop/peripherals/keyboard/kbd/options', value: "['ctrl\tctrl:swapcaps', 'Compose key\tcompose:ralt']" }
    - { key: 'desktop/sound/theme-name', value: "'__no_sounds'" }
    - { key: 'desktop/sound/event-sounds', value: "false" }

- name: Set MATE terminal settings
  dconf: key="/org/mate/terminal/profiles/default/{{ item.key }}" value={{ item.value }}
  loop:
    - { key: 'use-system-font', value: "true" }
    - { key: 'use-custom-default-size', value: "true" }
    - { key: 'default-show-menubar', value: "false" }
    - { key: 'default-size-columns', value: "100" }
    - { key: 'default-size-rows', value: "35" }
    - { key: 'background-type', value: "'transparent'" }
    - { key: 'background-darkness', value: "0.9" }
    - { key: 'scrollbar-position', value: "'hidden'" }
    - { key: 'scrollback-lines', value: "65535" }
    # Based on the hemisu-dark theme I found in https://github.com/Mayccoll/Gogh
    # which is based on https://noahfrederick.com/log/hemisu-for-os-x-terminal.html
    - { key: 'use-theme-colors', value: "false" }
    - { key: 'bold-color-same-as-fg', value: "true" }
    - { key: 'background-color', value: "'#000000000000'" }
    - { key: 'foreground-color', value: "'#FFFFFFFFFFFF'" }
    - { key: 'palette', value: "'#444444444444:#FFFF00005454:#B1B1D6D63030:#9D9D89895E5E:#6767BEBEE3E3:#B5B57676BCBC:#56569A999F9F:#EDEDEDEDEDED:#777777777777:#D6D65E5E7574:#BABAFFFFAAAA:#ECECE1E1C8C8:#9F9FD3D2E5E5:#DEDEB3B2DFDF:#B6B6E0E0E5E5:#FFFFFFFFFFFF'" }

- name: Set MATE desktop keybindings
  dconf: key="/org/mate/marco/global-keybindings/{{ item.key }}" value={{ item.value }}
  loop:
    # S-1..S-0: Switch to desktop 1..10
    - { key: 'switch-to-workspace-1', value: "'<Mod4>1'" }
    - { key: 'switch-to-workspace-2', value: "'<Mod4>2'" }
    - { key: 'switch-to-workspace-3', value: "'<Mod4>3'" }
    - { key: 'switch-to-workspace-4', value: "'<Mod4>4'" }
    - { key: 'switch-to-workspace-5', value: "'<Mod4>5'" }
    - { key: 'switch-to-workspace-6', value: "'<Mod4>6'" }
    - { key: 'switch-to-workspace-7', value: "'<Mod4>7'" }
    - { key: 'switch-to-workspace-8', value: "'<Mod4>8'" }
    - { key: 'switch-to-workspace-8', value: "'<Mod4>9'" }
    - { key: 'switch-to-workspace-8', value: "'<Mod4>0'" }

    # S-Left/S-Right: Switch to desktop on left/right
    - { key: 'switch-to-workspace-left', value: "'<Mod4>Left'" }
    - { key: 'switch-to-workspace-right', value: "'<Mod4>Right'" }
    - { key: 'switch-to-workspace-up', value: "'<Mod4>Up'" }
    - { key: 'switch-to-workspace-down', value: "'<Mod4>Down'" }

    # S-Tab: Swap to most recently used desktop
    - { key: 'switch-to-workspace-prev', value: "'<Mod4>Tab'" }

- name: Set MATE window keybindings
  dconf: key="/org/mate/marco/window-keybindings/{{ item.key }}" value={{ item.value }}
  loop:
    # S-s-1..S-s-0: Move window to desktop 1..10
    - { key: 'move-to-workspace-1', value: "'<Shift><Mod4>exclam'" }
    - { key: 'move-to-workspace-2', value: "'<Shift><Mod4>at'" }
    - { key: 'move-to-workspace-3', value: "'<Shift><Mod4>numbersign'" }
    - { key: 'move-to-workspace-4', value: "'<Shift><Mod4>dollar'" }
    - { key: 'move-to-workspace-5', value: "'<Shift><Mod4>percent'" }
    - { key: 'move-to-workspace-6', value: "'<Shift><Mod4>asciicircum'" }
    - { key: 'move-to-workspace-7', value: "'<Shift><Mod4>ampersand'" }
    - { key: 'move-to-workspace-8', value: "'<Shift><Mod4>asterisk'" }

    # S-s-Left/S-s-Right: Move window to desktop on left/right
    - { key: 'move-to-workspace-left', value: "'<Shift><Mod4>Left'" }
    - { key: 'move-to-workspace-right', value: "'<Shift><Mod4>Right'" }
    - { key: 'move-to-workspace-up', value: "'<Shift><Mod4>Up'" }
    - { key: 'move-to-workspace-down', value: "'<Shift><Mod4>Down'" }

- name: Unbind MATE media keys
  dconf: key="/org/mate/settings-daemon/plugins/media-keys/{{ item }}" value="'disabled'"
  loop:
    - 'play'
    - 'pause'
    - 'stop'
    - 'previous'
    - 'next'

- name: Set MATE custom keybindings
  dconf: key="/org/mate/desktop/keybindings/{{ item.key }}" value={{ item.value }}
  loop:
    # S-RET: Terminal
    - { key: 'custom0/action', value: "'mate-terminal'" }
    - { key: 'custom0/binding', value: "'<Mod4>Return'" }
    - { key: 'custom0/name', value: "'Terminal'" }

    # S-s-RET: Terminal, maximized
    - { key: 'custom1/action', value: "'mate-terminal --maximize'" }
    - { key: 'custom1/binding', value: "'<Shift><Mod4>Return'" }
    - { key: 'custom1/name', value: "'Terminal maximized'" }

    # S-SPC: Rofi (launcher)
    - { key: 'custom2/action', value: "'rofi -show run -display-run \">>> \"'" }
    - { key: 'custom2/binding', value: "'<Mod4>space'" }
    - { key: 'custom2/name', value: "'Rofi (Run)'" }

    # S-e: Emacs
    - { key: 'custom3/action', value: "'emacsclient -c -n --alternate-editor=\"\"'" }
    - { key: 'custom3/binding', value: "'<Mod4>e'" }
    - { key: 'custom3/name', value: "'Emacs Client'" }

    # S-s-e: Emacs, maximized
    - { key: 'custom4/action', value: "'emacsclient -c -n -F \"(list (fullscreen . maximized))\" --alternate-editor=\"\"'" }
    - { key: 'custom4/binding', value: "'<Shift><Mod4>e'" }
    - { key: 'custom4/name', value: "'Emacs maximized'" }

    # XF86AudioPlay: MPD play/pause
    - { key: 'custom5/action', value: "'mpc toggle'" }
    - { key: 'custom5/binding', value: "'AudioPlay'" }
    - { key: 'custom5/name', value: "'MPD play/pause'" }

    # XF86AudioStop: MPD stop
    - { key: 'custom6/action', value: "'mpc stop'" }
    - { key: 'custom6/binding', value: "'AudioStop'" }
    - { key: 'custom6/name', value: "'MPD stop'" }

    # XF86AudioPrev: MPD previous song
    - { key: 'custom7/action', value: "'mpc prev'" }
    - { key: 'custom7/binding', value: "'AudioPrev'" }
    - { key: 'custom7/name', value: "'MPD previous song'" }

    # XF86AudioNext: MPD next song
    - { key: 'custom8/action', value: "'mpc next'" }
    - { key: 'custom8/binding', value: "'AudioNext'" }
    - { key: 'custom8/name', value: "'MPD next song'" }

    # S-w: Cantata
    - { key: 'custom9/action', value: "'cantata'" }
    - { key: 'custom9/binding', value: "'<Mod4>w'" }
    - { key: 'custom9/name', value: "'Cantata (MPD client)'" }

    # PrtSc: Flameshot
    - { key: 'custom10/action', value: "'flameshot gui'" }
    - { key: 'custom10/binding', value: "'Print'" }
    - { key: 'custom10/name', value: "'Flameshot Screenshot'" }

    # S-s-j: org-capture
    - { key: 'custom11/action', value: "'emacsclient -c -n -e \"(jws/org-capture-single-window)\"'" }
    - { key: 'custom11/binding', value: "'<Shift><Mod4>j'" }
    - { key: 'custom11/name', value: "'Emacs org-capture'" }

    # S-s-a: org-agenda
    - { key: 'custom12/action', value: "'emacsclient -c -n -e \"(jws/org-agenda-single-window)\"'" }
    - { key: 'custom12/binding', value: "'<Shift><Mod4>a'" }
    - { key: 'custom12/name', value: "'Emacs org-agenda'" }

    # S-s-n: deft
    - { key: 'custom13/action', value: "'emacsclient -c -n -e \"(deft)\"'" }
    - { key: 'custom13/binding', value: "'<Shift><Mod4>n'" }
    - { key: 'custom13/name', value: "'Emacs deft'" }

# Right now, all this does is add a ~/.config/autostart that disables
# GNOME Keyring's SSH agent from starting.
# Note that the change to /org/mate/desktop/session/gnome-compat-startup
# (see above) is also a necessary part of this.
- name: Symlink MATE dotfiles
  shell: stow -d ~/Dotfiles -t ~ {{ item }}
  with_items:
    - mate
