---
- name: Install GUI applications
  apt: name={{ item }}
  become: yes
  with_items:
    - caja-dropbox
    - chromium-browser
    - emacs25-lucid
    - filezilla
    - firefox
    - gimp
    - git-gui
    - gitg
    - keepassx
    - qalculate-gtk
    - redshift-gtk
    - remmina
    - rofi
    - wireshark
    - vlc
    - xsel
    - zeal

- name: Install minimal desktop environment applications
  apt: name={{ item }}
  become: yes
  with_items:
    - alsa-utils
    - compton
    - dunst
    - feh
    - i3lock-fancy
    - lightdm-gtk-greeter
    - pulseaudio-utils
    - scrot

- name: Install MPD applications
  apt: name={{ item }}
  become: yes
  with_items:
    - mpd
    - mpc
    - cantata

- name: Symlink GUI application dotfiles
  shell: stow -d ~/Dotfiles -t ~ {{ item }}
  with_items:
    - dunst
    - mpd
    - redshift
    - rofi
    - xinitrc
    - xdefaults

- name: Ensure directories exist
  file: path={{ item }} state=directory
  with_items:
    - ~/.mpd/playlists

- name: Symlink ~/.xinitrc to ~/.xsession
  file: src=~/.xinitrc dst=~/.xsession state=link

- name: Create desktop session for the ~/.xinitrc
  become: yes
  copy:
    dest: /usr/share/xsessions/default.desktop
    content: |
      [Desktop Entry]
      Name=Default
      Comment=This runs the user's session
      Exec=default
      Icon=

- name: Enable lightdm-gtk-greeter
  become: yes
  copy:
    dest: /etc/lightdm/lightdm.conf
    content: |
      [SeatDefaults]
      greeter-session=lightdm-gtk-greeter
      [Seat:*]
      greeter-hide-users=true

- name: Clone StumpWM setup
  git:
    repo: https://github.com/jws85/.stumpwm.d
    dest: ~/.stumpwm.d

- name: Set MATE settings
  dconf: key="/org/mate/{{ item.key }}" value={{ item.value }}
  loop:
    - { key: 'desktop/interface/monospace-font-name', value: "'PragmataPro Mono 10.5'" }
    - { key: 'panel/objects/workspaceswitcherapplet/prefs/display-all-workspaces', value: "true" }
    - { key: 'panel/objects/workspaceswitcherapplet/prefs/num-rows', value: "1" }
    - { key: 'marco/general/num-workspaces', value: "10" }
    - { key: 'panel/objects/clockapplet/prefs/format', value: "'24-hour'" }
    - { key: 'panel/objects/clockapplet/prefs/show-date', value: "true" }
    - { key: 'desktop/peripherals/keyboard/kbd/options', value: "['ctrl\tctrl:swapcaps', 'Compose key\tcompose:ralt']" }
    - { key: 'desktop/sound/theme-name', value: "'__no_sounds'" }
    - { key: 'desktop/sound/event-sounds', value: "false" }

- name: Set MATE terminal settings
  dconf: key="/org/mate/terminal/profiles/default/{{ item.key }}" value={{ item.value }}
  loop:
    - { key: 'use-system-font', value: "true" }
    - { key: 'use-custom-default-size', value: "true" }
    - { key: 'default-show-menubar', value: "false" }
    - { key: 'default-size-columns', value: "100" }
    - { key: 'default-size-rows', value: "35" }
    - { key: 'background-type', value: "'transparent'" }
    - { key: 'background-darkness', value: "0.9" }
    - { key: 'scrollbar-position', value: "'hidden'" }
    - { key: 'scrollback-lines', value: "65535" }
    # Based on the hemisu-dark theme I found in https://github.com/Mayccoll/Gogh
    # which is based on https://noahfrederick.com/log/hemisu-for-os-x-terminal.html
    - { key: 'use-theme-colors', value: "false" }
    - { key: 'bold-color-same-as-fg', value: "true" }
    - { key: 'background-color', value: "'#000000000000'" }
    - { key: 'foreground-color', value: "'#FFFFFFFFFFFF'" }
    - { key: 'palette', value: "'#444444444444:#FFFF00005454:#B1B1D6D63030:#9D9D89895E5E:#6767BEBEE3E3:#B5B57676BCBC:#56569A999F9F:#EDEDEDEDEDED:#777777777777:#D6D65E5E7574:#BABAFFFFAAAA:#ECECE1E1C8C8:#9F9FD3D2E5E5:#DEDEB3B2DFDF:#B6B6E0E0E5E5:#FFFFFFFFFFFF'" }

- name: Set MATE keybindings
  dconf: key="/org/mate/marco/global-keybindings/{{ item.key }}" value={{ item.value }}
  loop:
    # S-1..S-0: Switch to desktop 1..10
    - { key: 'switch-to-workspace-1', value: "'<Mod4>1'" }
    - { key: 'switch-to-workspace-2', value: "'<Mod4>2'" }
    - { key: 'switch-to-workspace-3', value: "'<Mod4>3'" }
    - { key: 'switch-to-workspace-4', value: "'<Mod4>4'" }
    - { key: 'switch-to-workspace-5', value: "'<Mod4>5'" }
    - { key: 'switch-to-workspace-6', value: "'<Mod4>6'" }
    - { key: 'switch-to-workspace-7', value: "'<Mod4>7'" }
    - { key: 'switch-to-workspace-8', value: "'<Mod4>8'" }
    - { key: 'switch-to-workspace-9', value: "'<Mod4>9'" }
    - { key: 'switch-to-workspace-10', value: "'<Mod4>0'" }

    # S-s-1..S-s-0: Move window to desktop 1..10
    - { key: 'move-to-workspace-1', value: "'<Shift><Mod4>exclam'" }
    - { key: 'move-to-workspace-2', value: "'<Shift><Mod4>at'" }
    - { key: 'move-to-workspace-3', value: "'<Shift><Mod4>numbersign'" }
    - { key: 'move-to-workspace-4', value: "'<Shift><Mod4>dollar'" }
    - { key: 'move-to-workspace-5', value: "'<Shift><Mod4>percent'" }
    - { key: 'move-to-workspace-6', value: "'<Shift><Mod4>asciicircum'" }
    - { key: 'move-to-workspace-7', value: "'<Shift><Mod4>ampersand'" }
    - { key: 'move-to-workspace-8', value: "'<Shift><Mod4>asterisk'" }
    - { key: 'move-to-workspace-9', value: "'<Shift><Mod4>parenleft'" }
    - { key: 'move-to-workspace-10', value: "'<Shift><Mod4>parenright'" }

    # S-Left/S-Right: Switch to desktop on left/right
    - { key: 'switch-to-workspace-left', value: "'<Mod4>Left'" }
    - { key: 'switch-to-workspace-right', value: "'<Mod4>Right'" }
    - { key: 'switch-to-workspace-up', value: "'<Mod4>Up'" }
    - { key: 'switch-to-workspace-down', value: "'<Mod4>Down'" }

    # S-s-Left/S-s-Right: Move window to desktop on left/right
    - { key: 'move-to-workspace-left', value: "'<Shift><Mod4>Left'" }
    - { key: 'move-to-workspace-right', value: "'<Shift><Mod4>Right'" }
    - { key: 'move-to-workspace-up', value: "'<Shift><Mod4>Up'" }
    - { key: 'move-to-workspace-down', value: "'<Shift><Mod4>Down'" }

    # S-Tab: Swap to most recently used desktop
    - { key: 'switch-to-workspace-prev', value: "'<Mod4>Tab'" }

- name: Set MATE custom keybindings
  dconf: key="/org/mate/desktop/keybindings/{{ item.key }}" value={{ item.value }}
  loop:
    # S-RET: Terminal
    - { key: 'custom0/action', value: "'mate-terminal'" }
    - { key: 'custom0/binding', value: "'<Mod4>Return'" }
    - { key: 'custom0/name', value: "'Terminal'" }

    # S-SPC: Rofi (launcher)
    - { key: 'custom1/action', value: "'rofi -show run -display-run \">>> \"'" }
    - { key: 'custom1/binding', value: "'<Mod4>space'" }
    - { key: 'custom1/name', value: "'Rofi (Run)'" }

    # S-e: Emacs
    - { key: 'custom2/action', value: "'emacsclient -c -n --alternate-editor=\"\"'" }
    - { key: 'custom2/binding', value: "'<Mod4>e'" }
    - { key: 'custom2/name', value: "'Emacs Client'" }
